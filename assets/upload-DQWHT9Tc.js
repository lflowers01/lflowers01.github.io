import"./modulepreload-polyfill-B5Qt9EMX.js";import"./dark-mode-DgKG1Anf.js";const g="http://localhost:3001";document.addEventListener("DOMContentLoaded",async()=>{const w=document.getElementById("uploadForm"),f=document.getElementById("message"),i=document.getElementById("imagesList"),x=document.getElementById("imageCount");let d=null;const E=async()=>{try{return(await fetch(`${g}/api/health`,{method:"GET",headers:{"Content-Type":"application/json"}})).ok}catch{return!1}},l=async()=>{try{if(!await E()){i.innerHTML=`
          <div style="background: #ffe6e6; padding: 15px; border-radius: 4px; color: #c33;">
            <strong>⚠️ Upload server is not running!</strong>
            <p>Open a new terminal and run:</p>
            <code style="background: #333; color: #0f0; padding: 8px; display: block; margin-top: 10px; border-radius: 3px;">npm run upload-server</code>
            <p style="margin-top: 10px; font-size: 12px;">The dev server (npm run dev) and upload server must run in separate terminals.</p>
          </div>
        `;return}const a=await fetch(`${g}/api/carousel`);if(!a.ok)throw new Error("Failed to load images");const t=await a.json();if(x.textContent=t.length,i.innerHTML="",t.length===0){i.innerHTML="<p>No carousel images yet. Upload one to get started!</p>";return}t.forEach((r,L)=>{const e=document.createElement("div");e.className="image-item",e.draggable=!0,e.dataset.id=r.id,e.dataset.index=L,e.innerHTML=`
          <img src="/assets/carousel/${r.filename}" alt="${r.description}" />
          <div class="image-info">
            <div class="image-description">${r.description}</div>
            <div style="font-size: 11px; color: gray;">Uploaded: ${new Date(r.uploadedAt).toLocaleDateString()}</div>
          </div>
          <div class="image-controls">
            <button class="edit-btn" type="button">✎ Edit</button>
            <button class="delete-btn" type="button">✕ Delete</button>
          </div>
        `,e.querySelector(".edit-btn").addEventListener("click",async s=>{s.preventDefault();const c=prompt("Enter password to edit:");if(c){const m=prompt("Enter new description:",r.description);if(m!==null&&m!==r.description){r.description=m;const v=Array.from(i.querySelectorAll("[data-id]")).map(y=>{const u=y.dataset.id;return t.find(T=>T.id===u)});await h(v,c),l()}}}),e.querySelector(".delete-btn").addEventListener("click",async s=>{if(s.preventDefault(),confirm(`Delete "${r.description}"?`)){const c=prompt("Enter password to delete:");c&&await D(r.id,c)}}),e.addEventListener("dragstart",s=>{d=e,e.classList.add("dragging"),s.dataTransfer.effectAllowed="move"}),e.addEventListener("dragend",()=>{e.classList.remove("dragging"),document.querySelectorAll(".image-item").forEach(s=>{s.classList.remove("drag-over")}),d=null}),e.addEventListener("dragover",s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",e!==d&&e.classList.add("drag-over")}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",async s=>{if(s.preventDefault(),e.classList.remove("drag-over"),d&&d!==e){const c=Array.from(i.querySelectorAll(".image-item")),m=c.indexOf(d),v=c.indexOf(e);m<v?e.parentNode.insertBefore(d,e.nextSibling):e.parentNode.insertBefore(d,e);const y=Array.from(i.querySelectorAll(".image-item")).map(I=>I.dataset.id),u=prompt("Enter password to confirm reorder:");u?await h(y,u):l()}}),i.appendChild(e)})}catch(n){console.error("Error loading images:",n),i.innerHTML='<p style="color: red;">Error loading images. Make sure the upload server is running!</p>'}},D=async(n,a)=>{try{const t=await fetch(`${g}/api/delete/${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:a})}),r=await t.json();t.ok?(o("Image deleted successfully!","success"),l()):o(r.error||"Failed to delete image","error")}catch(t){o("Error deleting image: "+t.message,"error")}},h=async(n,a)=>{try{const t=await fetch(`${g}/api/reorder`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newOrder:n,password:a})}),r=await t.json();t.ok?(o("Images reordered successfully!","success"),await l()):o(r.error||"Failed to reorder images","error")}catch(t){o("Error reordering images: "+t.message,"error")}},o=(n,a)=>{f.textContent=n,f.className=`message ${a}`,setTimeout(()=>{f.className="message"},4e3)};w.addEventListener("submit",async n=>{n.preventDefault();const a=document.getElementById("password").value,t=document.getElementById("image"),r=document.getElementById("description").value;if(!t.files.length){o("Please select an image","error");return}if(!await E()){o("Upload server is not running. Run: npm run upload-server in a new terminal","error");return}const e=new FormData;e.append("image",t.files[0]),e.append("password",a),e.append("description",r);try{const p=await fetch(`${g}/api/upload`,{method:"POST",body:e}),b=await p.json();p.ok?(o("Image uploaded and optimized successfully!","success"),w.reset(),l()):o(b.error||"Upload failed","error")}catch(p){o("Error uploading image: "+p.message,"error")}}),l()});
